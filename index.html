<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プロセカ・イベントボーダー予測</title>
    <!-- Tailwind CSS for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #0f172a;
            --accent-main: #22d3ee; /* 動的に上書きされるデフォルト色 */
            --accent-sub: #f472b6;  /* 動的に上書きされるデフォルト色 */
            --card-glass: rgba(30, 41, 59, 0.7);
        }

        body {
            background-color: var(--primary-bg);
            background-image: 
                radial-gradient(at 0% 0%, rgba(var(--accent-main-rgb, 34, 211, 238), 0.15) 0, transparent 50%),
                radial-gradient(at 100% 100%, rgba(var(--accent-sub-rgb, 244, 114, 182), 0.15) 0, transparent 50%);
            color: #f8fafc;
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            min-height: 100vh;
            transition: background-image 0.5s ease;
        }

        .glass-card {
            background: var(--card-glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 35px -10px rgba(0, 0, 0, 0.4);
            border-color: rgba(var(--accent-main-rgb, 34, 211, 238), 0.3);
        }

        .neon-text-main {
            color: var(--accent-main);
            text-shadow: 0 0 10px rgba(var(--accent-main-rgb, 34, 211, 238), 0.8);
        }

        .badge-character {
            background: linear-gradient(135deg, #1e293b, #334155);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.15rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 800;
            color: var(--accent-main);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: color 0.5s ease;
        }

        .badge-type {
            background: linear-gradient(135deg, #4c1d95, #6d28d9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.15rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 800;
            color: #ede9fe;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .table-container::-webkit-scrollbar {
            height: 6px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        .status-info { border-left: 4px solid #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .status-warn { border-left: 4px solid #fbbf24; background: rgba(251, 191, 36, 0.1); }
        .status-critical { border-left: 4px solid #ef4444; background: rgba(239, 68, 68, 0.1); }

        @keyframes pulse-custom {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-pulse { animation: pulse-custom 2s infinite; }

        .progress-bar-bg {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-bar-fill {
            background: linear-gradient(90deg, var(--accent-main), var(--accent-sub));
            height: 100%;
            transition: width 1s ease-out, background 0.5s ease;
        }

        /* 順位ごとの装飾用 */
        .rank-highlight {
            color: var(--accent-main);
            text-decoration-color: rgba(var(--accent-main-rgb), 0.3);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto space-y-8">
        <!-- Header Section -->
        <header class="glass-card p-6 relative overflow-hidden">
            <div id="event-header-loading" class="loading-pulse">
                <div class="h-8 bg-slate-700 w-3/4 mb-4 rounded"></div>
                <div class="h-4 bg-slate-700 w-1/2 rounded"></div>
            </div>
            <div id="event-header-content" class="hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div class="space-y-2">
                        <div class="flex flex-wrap items-center gap-2">
                            <h1 id="event-name" class="text-2xl md:text-4xl font-black neon-text-main tracking-tighter">--</h1>
                            <div class="flex gap-2">
                                <span id="event-banner" class="badge-character">--</span>
                                <span id="event-type" class="badge-type">--</span>
                            </div>
                        </div>
                        <p class="text-slate-400 mt-1 flex items-center gap-2 text-sm">
                            <i class="fa-solid fa-clock"></i> 最終更新: <span id="last-update">--</span> (JST)
                            <span class="text-xs bg-slate-800 px-2 py-0.5 rounded text-slate-300">次回更新: 21時頃</span>
                        </p>
                    </div>
                    <div class="text-right w-full md:w-auto">
                        <div class="text-lg font-bold" style="color: var(--accent-main)">Day <span id="current-day">0</span> / <span id="total-days">0</span></div>
                        <div class="progress-bar-bg w-full md:w-48 mt-2">
                            <div id="progress-fill" class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left & Middle Section -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Border Table -->
                <section class="glass-card p-6 overflow-hidden">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-chart-line" style="color: var(--accent-main)"></i> ボーダー確認・予測
                    </h2>
                    <div class="table-container overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="py-3 px-4 text-xs font-bold text-slate-400 uppercase tracking-wider">順位</th>
                                    <th class="py-3 px-4 text-xs font-bold text-slate-400 uppercase tracking-wider">実績 (21時)</th>
                                    <th class="py-3 px-4 text-xs font-bold text-slate-400 uppercase tracking-wider">翌日21時予測</th>
                                    <th class="py-3 px-4 text-xs font-bold uppercase tracking-wider" style="color: var(--accent-sub)">最終予測(p50)</th>
                                    <th class="py-3 px-4 text-xs font-bold uppercase tracking-wider" style="color: var(--accent-main)">安全圏(p90)</th>
                                </tr>
                            </thead>
                            <tbody id="border-table-body">
                                <!-- Generated by JS -->
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 p-3 bg-slate-900/50 rounded-lg text-xs text-slate-400 flex gap-2">
                        <i class="fa-solid fa-circle-info mt-0.5"></i>
                        <p>更新は毎日21時頃。最終日や集計遅延時は評価のみ行い、予測更新を行わない場合があります。数値はあくまで統計的な予測です。</p>
                    </div>
                </section>

                <!-- Status/Notice Board -->
                <section class="glass-card p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-bullhorn" style="color: var(--accent-sub)"></i> お知らせ
                    </h2>
                    <div id="status-board" class="space-y-3 max-h-80 overflow-y-auto pr-2">
                        <p class="text-slate-500 text-sm italic">読み込み中...</p>
                    </div>
                </section>
            </div>

            <!-- Right Sidebar: SNS & Links -->
            <div class="space-y-8">
                <!-- Info Card -->
                <section class="glass-card p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-circle-question" style="color: var(--accent-main)"></i> このサイトについて
                    </h2>
                    <p class="text-xs text-slate-300 leading-relaxed">
                        本サイトは、プロセカの過去イベントデータに基づき、独自のアルゴリズムで現在のボーダーから最終数値を予測しています。
                    </p>
                    <ul class="mt-4 space-y-2 text-[11px] text-slate-400 list-disc list-inside">
                        <li>予測値は統計に基づいた期待値です</li>
                        <li>最終日の伸びは考慮されています</li>
                        <li>公式データではありません</li>
                    </ul>
                </section>

                <!-- Contact & Support -->
                <section class="glass-card p-6 border-t-4" style="border-top-color: var(--accent-sub)">
                    <h2 class="text-xl font-bold mb-4 text-slate-100">データ提供・連絡先</h2>
                    <p class="text-sm text-slate-300 mb-6">データの不備や予測に関するお問い合わせ、不具合報告は下記SNSまでお寄せください。</p>
                    <div class="flex flex-col gap-3">
                        <a href="https://twitter.com/Pj_sekai_bdsg" target="_blank" class="flex items-center justify-center gap-2 bg-slate-100 text-slate-900 font-bold py-2 px-4 rounded-full hover:opacity-80 transition-all">
                            <i class="fa-brands fa-x-twitter"></i> 公式Xプロフィール
                        </a>
                        <a id="dm-button" href="https://twitter.com/messages/compose?recipient_id=Pj_sekai_bdsg" target="_blank" class="flex items-center justify-center gap-2 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all" style="background-color: var(--accent-sub)">
                            <i class="fa-solid fa-envelope"></i> DMで問い合わせる
                        </a>
                    </div>
                </section>
            </div>
        </div>

        <footer class="text-center text-slate-500 text-sm py-8">
            &copy; 2024 Pj_sekai_bdsg. This project is a fan-made site.
        </footer>
    </div>

    <script>
        // --- Character Themes Configuration ---
        const CHARACTER_THEMES = {
            "日野森雫": { main: "#22d3ee", sub: "#f472b6", main_rgb: "34, 211, 238", sub_rgb: "244, 114, 182" },
            "星乃一歌": { main: "#3b82f6", sub: "#93c5fd", main_rgb: "59, 130, 246", sub_rgb: "147, 197, 253" },
            "天馬咲希": { main: "#fbbf24", sub: "#fcd34d", main_rgb: "251, 191, 36", sub_rgb: "252, 211, 77" },
            "望月穂波": { main: "#f87171", sub: "#fca5a5", main_rgb: "248, 113, 113", sub_rgb: "252, 165, 165" },
            "日野森志歩": { main: "#a3e635", sub: "#d9f99d", main_rgb: "163, 230, 53", sub_rgb: "217, 249, 157" },
            "花里みのり": { main: "#fb923c", sub: "#fdba74", main_rgb: "251, 146, 60", sub_rgb: "253, 186, 116" },
            "桐谷遥": { main: "#60a5fa", sub: "#93c5fd", main_rgb: "96, 165, 250", sub_rgb: "147, 197, 253" },
            "桃井愛莉": { main: "#f472b6", sub: "#f9a8d4", main_rgb: "244, 114, 182", sub_rgb: "249, 168, 212" },
            "小豆沢こはね": { main: "#facc15", sub: "#fef08a", main_rgb: "250, 204, 21", sub_rgb: "254, 240, 138" },
            "白石杏": { main: "#2563eb", sub: "#60a5fa", main_rgb: "37, 99, 235", sub_rgb: "96, 165, 250" },
            "東雲彰人": { main: "#ea580c", sub: "#fb923c", main_rgb: "234, 88, 12", sub_rgb: "251, 146, 60" },
            "青柳冬弥": { main: "#0ea5e9", sub: "#7dd3fc", main_rgb: "14, 165, 233", sub_rgb: "125, 211, 252" },
            "天馬司": { main: "#fbbf24", sub: "#f59e0b", main_rgb: "251, 191, 36", sub_rgb: "245, 158, 11" },
            "鳳えむ": { main: "#f472b6", sub: "#ec4899", main_rgb: "244, 114, 182", sub_rgb: "236, 72, 153" },
            "草薙寧々": { main: "#4ade80", sub: "#22c55e", main_rgb: "74, 222, 128", sub_rgb: "34, 197, 94" },
            "神代類": { main: "#a855f7", sub: "#8b5cf6", main_rgb: "168, 85, 247", sub_rgb: "139, 92, 246" },
            "宵崎奏": { main: "#94a3b8", sub: "#cbd5e1", main_rgb: "148, 163, 184", sub_rgb: "203, 213, 225" },
            "朝比奈まふゆ": { main: "#6366f1", sub: "#818cf8", main_rgb: "99, 102, 241", sub_rgb: "129, 140, 248" },
            "東雲絵名": { main: "#b45309", sub: "#d97706", main_rgb: "180, 83, 9", sub_rgb: "217, 119, 6" },
            "暁山瑞希": { main: "#e879f9", sub: "#f5d0fe", main_rgb: "232, 121, 249", sub_rgb: "245, 208, 254" }
        };

        const DEFAULT_THEME = { main: "#22d3ee", sub: "#f472b6", main_rgb: "34, 211, 238", sub_rgb: "244, 114, 182" };

        // --- Mock Data ---
        const mockLatest = {
            "event": {
                "name": "導く想い、結ぶ縁",
                "banner": "日野森雫",
                "type": "チアフル"
            },
            "snapshot": {"jst_date":"2024-05-10","approx_time":"21:00"},
            "progress": {"N":10,"day":3},
            "ranks": {
                "10": {"actual":15241500,"final_p50":450000000,"final_p90":520000000,"next_21":45000000},
                "100": {"actual":3025415,"final_p50":81458633,"final_p90":94397428,"next_21":9979329},
                "200": {"actual":2214280,"final_p50":38562335,"final_p90":47685422,"next_21":6438576},
                "1000": {"actual":854120,"final_p50":15240000,"final_p90":18500000,"next_21":1254000}
            }
        };

        const mockStatus = [
            {"date":"2024-05-10","title":"予測ロジック更新","body":"イベント形式の変更に伴い、予測アルゴリズムを微調整しました。","level":"info"}
        ];

        const formatNumber = (num) => {
            if (num === null || num === undefined) return "---";
            return num.toLocaleString();
        };

        function applyTheme(charName) {
            const theme = CHARACTER_THEMES[charName] || DEFAULT_THEME;
            const root = document.documentElement;
            
            root.style.setProperty('--accent-main', theme.main);
            root.style.setProperty('--accent-sub', theme.sub);
            root.style.setProperty('--accent-main-rgb', theme.main_rgb);
            root.style.setProperty('--accent-sub-rgb', theme.sub_rgb);
        }

        async function init() {
            const timestamp = Date.now();
            
            try {
                const res = await fetch(`./data/latest.json?t=${timestamp}`);
                if (!res.ok) throw new Error();
                const data = await res.json();
                renderLatest(data);
            } catch (err) {
                renderLatest(mockLatest);
            }

            try {
                const res = await fetch(`./data/status.json?t=${timestamp}`);
                if (!res.ok) throw new Error();
                const data = await res.json();
                renderStatus(data);
            } catch (err) {
                renderStatus(mockStatus);
            }
        }

        function renderLatest(data) {
            // テーマの適用
            const bannerChar = data.event?.banner || "日野森雫";
            applyTheme(bannerChar);

            document.getElementById('event-header-loading').classList.add('hidden');
            document.getElementById('event-header-content').classList.remove('hidden');
            
            const urlParams = new URLSearchParams(window.location.search);
            document.getElementById('event-name').textContent = urlParams.get('event') || data.event?.name || "--";
            document.getElementById('event-banner').textContent = bannerChar;
            document.getElementById('event-type').textContent = data.event?.type || "--";
            
            document.getElementById('last-update').textContent = `${data.snapshot.jst_date} ${data.snapshot.approx_time}`;
            
            const { N, day } = data.progress;
            document.getElementById('current-day').textContent = day;
            document.getElementById('total-days').textContent = N;
            document.getElementById('progress-fill').style.width = `${(day / N) * 100}%`;

            const tbody = document.getElementById('border-table-body');
            tbody.innerHTML = '';

            Object.keys(data.ranks).sort((a, b) => parseInt(a) - parseInt(b)).forEach(rank => {
                const info = data.ranks[rank];
                const tr = document.createElement('tr');
                tr.className = 'border-b border-slate-800 hover:bg-white/5 transition-colors';
                tr.innerHTML = `
                    <td class="py-4 px-4 font-bold text-slate-300 underline rank-highlight">TOP ${rank}位</td>
                    <td class="py-4 px-4 font-mono">${formatNumber(info.actual)}</td>
                    <td class="py-4 px-4 font-mono text-slate-400">${formatNumber(info.next_21)}</td>
                    <td class="py-4 px-4 font-mono font-bold" style="color: var(--accent-sub)">${formatNumber(info.final_p50)}</td>
                    <td class="py-4 px-4 font-mono font-bold" style="color: var(--accent-main)">${formatNumber(info.final_p90)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderStatus(data) {
            const container = document.getElementById('status-board');
            container.innerHTML = '';

            if (!Array.isArray(data) || data.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-sm">現在、新しいお知らせはありません。</p>';
                return;
            }

            [...data].sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(item => {
                const div = document.createElement('div');
                div.className = `p-4 rounded-r-lg mb-3 ${item.level === 'critical' ? 'status-critical' : item.level === 'warn' ? 'status-warn' : 'status-info'}`;
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <h3 class="font-bold text-slate-100">${item.title}</h3>
                        <span class="text-[10px] text-slate-500 font-mono">${item.date}</span>
                    </div>
                    <p class="text-sm text-slate-400 mt-1">${item.body}</p>
                `;
                container.appendChild(div);
            });
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>