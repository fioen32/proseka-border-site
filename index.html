<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プロセカ・イベントボーダー予測</title>
    <!-- Tailwind CSS for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #0f172a;
            --accent-cyan: #22d3ee;
            --accent-pink: #f472b6;
            --card-glass: rgba(30, 41, 59, 0.7);
        }

        body {
            background-color: var(--primary-bg);
            background-image: 
                radial-gradient(at 0% 0%, rgba(34, 211, 238, 0.15) 0, transparent 50%),
                radial-gradient(at 100% 100%, rgba(244, 114, 182, 0.15) 0, transparent 50%);
            color: #f8fafc;
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            min-height: 100vh;
        }

        .glass-card {
            background: var(--card-glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 35px -10px rgba(0, 0, 0, 0.4);
            border-color: rgba(34, 211, 238, 0.3);
        }

        .neon-text-cyan {
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.8);
        }

        .badge-character {
            background: linear-gradient(135deg, #1e293b, #334155);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.15rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 800;
            color: var(--accent-cyan);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .badge-type {
            background: linear-gradient(135deg, #4c1d95, #6d28d9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.15rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 800;
            color: #ede9fe;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .table-container::-webkit-scrollbar {
            height: 6px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        .status-info { border-left: 4px solid #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .status-warn { border-left: 4px solid #fbbf24; background: rgba(251, 191, 36, 0.1); }
        .status-critical { border-left: 4px solid #ef4444; background: rgba(239, 68, 68, 0.1); }

        @keyframes pulse-custom {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-pulse { animation: pulse-custom 2s infinite; }

        .progress-bar-bg {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-bar-fill {
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-pink));
            height: 100%;
            transition: width 1s ease-out;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto space-y-8">
        <!-- Header Section -->
        <header class="glass-card p-6 relative overflow-hidden">
            <div id="event-header-loading" class="loading-pulse">
                <div class="h-8 bg-slate-700 w-3/4 mb-4 rounded"></div>
                <div class="h-4 bg-slate-700 w-1/2 rounded"></div>
            </div>
            <div id="event-header-content" class="hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div class="space-y-2">
                        <div class="flex flex-wrap items-center gap-2">
                            <h1 id="event-name" class="text-2xl md:text-4xl font-black neon-text-cyan tracking-tighter">--</h1>
                            <div class="flex gap-2">
                                <span id="event-banner" class="badge-character">--</span>
                                <span id="event-type" class="badge-type">--</span>
                            </div>
                        </div>
                        <p class="text-slate-400 mt-1 flex items-center gap-2 text-sm">
                            <i class="fa-solid fa-clock"></i> 最終更新: <span id="last-update">--</span> (JST)
                            <span class="text-xs bg-slate-800 px-2 py-0.5 rounded text-slate-300">次回更新: 21時頃</span>
                        </p>
                    </div>
                    <div class="text-right w-full md:w-auto">
                        <div class="text-lg font-bold text-cyan-400">Day <span id="current-day">0</span> / <span id="total-days">0</span></div>
                        <div class="progress-bar-bg w-full md:w-48 mt-2">
                            <div id="progress-fill" class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left & Middle Section -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Border Table -->
                <section class="glass-card p-6 overflow-hidden">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-chart-line text-cyan-400"></i> ボーダー確認・予測
                    </h2>
                    <div class="table-container overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="py-3 px-4 text-xs font-bold text-slate-400 uppercase tracking-wider">順位</th>
                                    <th class="py-3 px-4 text-xs font-bold text-slate-400 uppercase tracking-wider">実績 (21時)</th>
                                    <th class="py-3 px-4 text-xs font-bold text-slate-400 uppercase tracking-wider">翌日21時予測</th>
                                    <th class="py-3 px-4 text-xs font-bold text-pink-400 uppercase tracking-wider">最終予測(p50)</th>
                                    <th class="py-3 px-4 text-xs font-bold text-cyan-400 uppercase tracking-wider">安全圏(p90)</th>
                                </tr>
                            </thead>
                            <tbody id="border-table-body">
                                <!-- Generated by JS -->
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 p-3 bg-slate-900/50 rounded-lg text-xs text-slate-400 flex gap-2">
                        <i class="fa-solid fa-circle-info mt-0.5"></i>
                        <p>更新は毎日21時頃。最終日や集計遅延時は評価のみ行い、予測更新を行わない場合があります。数値はあくまで統計的な予測です。</p>
                    </div>
                </section>

                <!-- Status/Notice Board -->
                <section class="glass-card p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-bullhorn text-pink-400"></i> お知らせ
                    </h2>
                    <div id="status-board" class="space-y-3 max-h-80 overflow-y-auto pr-2">
                        <p class="text-slate-500 text-sm italic">読み込み中...</p>
                    </div>
                </section>
            </div>

            <!-- Right Sidebar: SNS & Links -->
            <div class="space-y-8">
                <!-- Info Card -->
                <section class="glass-card p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-circle-question text-cyan-400"></i> このサイトについて
                    </h2>
                    <p class="text-xs text-slate-300 leading-relaxed">
                        本サイトは、プロセカの過去イベントデータに基づき、独自のアルゴリズムで現在のボーダーから最終数値を予測しています。
                    </p>
                    <ul class="mt-4 space-y-2 text-[11px] text-slate-400 list-disc list-inside">
                        <li>予測値は統計に基づいた期待値です</li>
                        <li>最終日の伸びは考慮されています</li>
                        <li>公式データではありません</li>
                    </ul>
                </section>

                <!-- Contact & Support -->
                <section class="glass-card p-6 border-t-4 border-pink-500">
                    <h2 class="text-xl font-bold mb-4 text-pink-100">データ提供・連絡先</h2>
                    <p class="text-sm text-slate-300 mb-6">データの不備や予測に関するお問い合わせ、不具合報告は下記SNSまでお寄せください。</p>
                    <div class="flex flex-col gap-3">
                        <a href="https://twitter.com/Pj_sekai_bdsg" target="_blank" class="flex items-center justify-center gap-2 bg-slate-100 text-slate-900 font-bold py-2 px-4 rounded-full hover:bg-cyan-400 hover:text-white transition-all">
                            <i class="fa-brands fa-x-twitter"></i> 公式Xプロフィール
                        </a>
                        <a href="https://twitter.com/messages/compose?recipient_id=Pj_sekai_bdsg" target="_blank" class="flex items-center justify-center gap-2 bg-pink-600 text-white font-bold py-2 px-4 rounded-full hover:bg-pink-500 shadow-lg shadow-pink-900/20 transition-all">
                            <i class="fa-solid fa-envelope"></i> DMで問い合わせる
                        </a>
                    </div>
                </section>
            </div>
        </div>

        <footer class="text-center text-slate-500 text-sm py-8">
            &copy; 2024 Pj_sekai_bdsg. This project is a fan-made site.
        </footer>
    </div>

    <script>
        // --- Configuration ---
        const EVENT_NAME = "導く想い、結ぶ縁";
        const EVENT_BANNER = "日野森雫";
        const EVENT_TYPE = "チアフル";

        const mockLatest = {
            "event": {
                "name": "導く想い、結ぶ縁",
                "banner": "花里みのり",
                "type": "混合・マラソン"
            },
            "snapshot": {"jst_date":"2024-05-10","approx_time":"21:00"},
            "progress": {"N":10,"day":3},
            "ranks": {
                "10": {"actual":15241500,"final_p50":450000000,"final_p90":520000000,"next_21":45000000},
                "100": {"actual":3025415,"final_p50":81458633,"final_p90":94397428,"next_21":9979329},
                "200": {"actual":2214280,"final_p50":38562335,"final_p90":47685422,"next_21":6438576},
                "1000": {"actual":854120,"final_p50":15240000,"final_p90":18500000,"next_21":1254000}
            }
        };

        const mockStatus = [
            {"date":"2024-05-10","title":"予測ロジック更新","body":"イベント形式の変更に伴い、予測アルゴリズムを微調整しました。","level":"info"}
        ];

        const formatNumber = (num) => {
            if (num === null || num === undefined) return "---";
            return num.toLocaleString();
        };

        async function init() {
            const timestamp = Date.now();
            
            try {
                const res = await fetch(`./data/latest.json?t=${timestamp}`);
                if (!res.ok) throw new Error();
                const data = await res.json();
                renderLatest(data);
            } catch (err) {
                renderLatest(mockLatest);
            }

            try {
                const res = await fetch(`./data/status.json?t=${timestamp}`);
                if (!res.ok) throw new Error();
                const data = await res.json();
                renderStatus(data);
            } catch (err) {
                renderStatus(mockStatus);
            }
        }

        function renderLatest(data) {
            document.getElementById('event-header-loading').classList.add('hidden');
            document.getElementById('event-header-content').classList.remove('hidden');
            
            const urlParams = new URLSearchParams(window.location.search);
            document.getElementById('event-name').textContent = urlParams.get('event') || data.event?.name || EVENT_NAME;
            document.getElementById('event-banner').textContent = data.event?.banner || EVENT_BANNER;
            document.getElementById('event-type').textContent = data.event?.type || EVENT_TYPE;
            
            document.getElementById('last-update').textContent = `${data.snapshot.jst_date} ${data.snapshot.approx_time}`;
            
            const { N, day } = data.progress;
            document.getElementById('current-day').textContent = day;
            document.getElementById('total-days').textContent = N;
            document.getElementById('progress-fill').style.width = `${(day / N) * 100}%`;

            const tbody = document.getElementById('border-table-body');
            tbody.innerHTML = '';

            Object.keys(data.ranks).sort((a, b) => parseInt(a) - parseInt(b)).forEach(rank => {
                const info = data.ranks[rank];
                const tr = document.createElement('tr');
                tr.className = 'border-b border-slate-800 hover:bg-white/5 transition-colors';
                tr.innerHTML = `
                    <td class="py-4 px-4 font-bold text-slate-300 underline decoration-cyan-500/30">TOP ${rank}位</td>
                    <td class="py-4 px-4 font-mono">${formatNumber(info.actual)}</td>
                    <td class="py-4 px-4 font-mono text-slate-400">${formatNumber(info.next_21)}</td>
                    <td class="py-4 px-4 font-mono text-pink-400 font-bold">${formatNumber(info.final_p50)}</td>
                    <td class="py-4 px-4 font-mono text-cyan-400 font-bold">${formatNumber(info.final_p90)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderStatus(data) {
            const container = document.getElementById('status-board');
            container.innerHTML = '';

            if (!Array.isArray(data) || data.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-sm">現在、新しいお知らせはありません。</p>';
                return;
            }

            [...data].sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(item => {
                const div = document.createElement('div');
                div.className = `p-4 rounded-r-lg mb-3 ${item.level === 'critical' ? 'status-critical' : item.level === 'warn' ? 'status-warn' : 'status-info'}`;
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <h3 class="font-bold text-slate-100">${item.title}</h3>
                        <span class="text-[10px] text-slate-500 font-mono">${item.date}</span>
                    </div>
                    <p class="text-sm text-slate-400 mt-1">${item.body}</p>
                `;
                container.appendChild(div);
            });
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>